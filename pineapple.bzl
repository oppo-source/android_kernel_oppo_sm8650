load(":target_variants.bzl", "la_variants")
load(":msm_kernel_la.bzl", "define_msm_la")
load(":image_opts.bzl", "boot_image_opts")

load("//oplus/bazel:oplus_modules_define.bzl", _get_oplus_features = "oplus_ddk_get_oplus_features")

target_name = "pineapple"

def define_pineapple():
    _pineapple_in_tree_modules = [
        # keep sorted
        "arch/arm64/gunyah/gh_arm_drv.ko",
        "drivers/base/regmap/qti-regmap-debugfs.ko",
        "drivers/bus/mhi/devices/mhi_dev_satellite.ko",
        "drivers/bus/mhi/devices/mhi_dev_uci.ko",
        "drivers/bus/mhi/host/mhi.ko",
        "drivers/char/rdbg.ko",
        "drivers/clk/qcom/camcc-cliffs.ko",
        "drivers/clk/qcom/camcc-pineapple.ko",
        "drivers/clk/qcom/camcc-volcano.ko",
        "drivers/clk/qcom/clk-dummy.ko",
        "drivers/clk/qcom/clk-qcom.ko",
        "drivers/clk/qcom/clk-rpmh.ko",
        "drivers/clk/qcom/debugcc-cliffs.ko",
        "drivers/clk/qcom/debugcc-pineapple.ko",
        "drivers/clk/qcom/debugcc-volcano.ko",
        "drivers/clk/qcom/dispcc-pineapple.ko",
        "drivers/clk/qcom/dispcc-volcano.ko",
        "drivers/clk/qcom/gcc-cliffs.ko",
        "drivers/clk/qcom/gcc-pineapple.ko",
        "drivers/clk/qcom/gcc-volcano.ko",
        "drivers/clk/qcom/gdsc-regulator.ko",
        "drivers/clk/qcom/gpucc-cliffs.ko",
        "drivers/clk/qcom/gpucc-pineapple.ko",
        "drivers/clk/qcom/gpucc-volcano.ko",
        "drivers/clk/qcom/tcsrcc-pineapple.ko",
        "drivers/clk/qcom/videocc-pineapple.ko",
        "drivers/clk/qcom/videocc-volcano.ko",
        "drivers/cpufreq/qcom-cpufreq-hw.ko",
        "drivers/cpufreq/qcom-cpufreq-hw-debug.ko",
        "drivers/cpuidle/governors/qcom_lpm.ko",
        "drivers/dma-buf/heaps/qcom_dma_heaps.ko",
        "drivers/dma/qcom/bam_dma.ko",
        "drivers/dma/qcom/msm_gpi.ko",
        "drivers/edac/qcom_edac.ko",
        "drivers/firmware/arm_scmi/qcom_scmi_vendor.ko",
        "drivers/firmware/qcom-scm.ko",
        "drivers/gpu/drm/bridge/lt9611uxc.ko",
        "drivers/gpu/drm/display/drm_display_helper.ko",
        "drivers/gpu/drm/display/drm_dp_aux_bus.ko",
        "drivers/hwmon/hwmon.ko",
        "drivers/hwmon/qti_amoled_ecm.ko",
        "drivers/hwspinlock/qcom_hwspinlock.ko",
        "drivers/hwtracing/coresight/coresight.ko",
        "drivers/hwtracing/coresight/coresight-csr.ko",
        "drivers/hwtracing/coresight/coresight-cti.ko",
        "drivers/hwtracing/coresight/coresight-dummy.ko",
        "drivers/hwtracing/coresight/coresight-funnel.ko",
        "drivers/hwtracing/coresight/coresight-hwevent.ko",
        "drivers/hwtracing/coresight/coresight-remote-etm.ko",
        "drivers/hwtracing/coresight/coresight-replicator.ko",
        "drivers/hwtracing/coresight/coresight-stm.ko",
        "drivers/hwtracing/coresight/coresight-tgu.ko",
        "drivers/hwtracing/coresight/coresight-tmc.ko",
        "drivers/hwtracing/coresight/coresight-tmc-sec.ko",
        "drivers/hwtracing/coresight/coresight-tpda.ko",
        "drivers/hwtracing/coresight/coresight-tpdm.ko",
        "drivers/hwtracing/coresight/coresight-trace-noc.ko",
        "drivers/hwtracing/stm/stm_console.ko",
        "drivers/hwtracing/stm/stm_core.ko",
        "drivers/hwtracing/stm/stm_ftrace.ko",
        "drivers/hwtracing/stm/stm_heartbeat.ko",
        "drivers/hwtracing/stm/stm_p_ost.ko",
        "drivers/i2c/busses/i2c-msm-geni.ko",
        "drivers/i3c/master/i3c-master-msm-geni.ko",
        "drivers/iio/adc/qcom-spmi-adc5-gen3.ko",
        "drivers/iio/adc/qcom-vadc-common.ko",
        "drivers/iio/adc/qti-glink-adc.ko",
        "drivers/input/misc/pm8941-pwrkey.ko",
        "drivers/input/misc/qcom-hv-haptics.ko",
        "drivers/misc/vibrator/aw8697_haptic/haptic_feedback.ko",
        "drivers/misc/vibrator/aw8697_haptic/haptic.ko",
        "drivers/misc/vibrator/aw8697_haptic/aw8697.ko",
        "drivers/misc/vibrator/si_haptic/si_haptic.ko",
        "drivers/input/misc/qpnp-power-on.ko",
        "drivers/leds/aw20198/leds-aw20198.ko",
        "drivers/interconnect/icc-test.ko",
        "drivers/interconnect/qcom/icc-bcm-voter.ko",
        "drivers/interconnect/qcom/icc-debug.ko",
        "drivers/interconnect/qcom/icc-rpmh.ko",
        "drivers/interconnect/qcom/qnoc-cliffs.ko",
        "drivers/interconnect/qcom/qnoc-pineapple.ko",
        "drivers/interconnect/qcom/qnoc-qos.ko",
        "drivers/interconnect/qcom/qnoc-volcano.ko",
        "drivers/iommu/arm/arm-smmu/arm_smmu.ko",
        "drivers/iommu/iommu-logger.ko",
        "drivers/iommu/msm_dma_iommu_mapping.ko",
        "drivers/iommu/qcom_iommu_debug.ko",
        "drivers/iommu/qcom_iommu_util.ko",
        "drivers/irqchip/msm_show_resume_irq.ko",
        "drivers/irqchip/qcom-pdc.ko",
        "drivers/leds/leds-qpnp-vibrator-ldo.ko",
        "drivers/leds/leds-qti-flash.ko",
        "drivers/leds/leds-qti-tri-led.ko",
        "drivers/mailbox/msm_qmp.ko",
        "drivers/mailbox/qcom-ipcc.ko",
        "drivers/mfd/qcom-i2c-pmic.ko",
        "drivers/mfd/qcom-spmi-pmic.ko",
        "drivers/misc/qseecom_proxy.ko",
        "drivers/mmc/host/cqhci.ko",
        "drivers/mmc/host/sdhci-msm.ko",
        "drivers/nvmem/nvmem_qcom-spmi-sdam.ko",
        "drivers/nvmem/nvmem_qfprom.ko",
        "drivers/pci/controller/pci-msm-drv.ko",
        "drivers/perf/qcom_llcc_pmu.ko",
        "drivers/phy/qualcomm/phy-qcom-ufs.ko",
        "drivers/phy/qualcomm/phy-qcom-ufs-qmp-v4.ko",
        "drivers/phy/qualcomm/phy-qcom-ufs-qmp-v4-crow.ko",
        "drivers/phy/qualcomm/phy-qcom-ufs-qmp-v4-pineapple.ko",
        "drivers/phy/qualcomm/phy-qcom-ufs-qrbtc-sdm845.ko",
        "drivers/pinctrl/qcom/pinctrl-cliffs.ko",
        "drivers/pinctrl/qcom/pinctrl-msm.ko",
        "drivers/pinctrl/qcom/pinctrl-pineapple.ko",
        "drivers/pinctrl/qcom/pinctrl-spmi-gpio.ko",
        "drivers/pinctrl/qcom/pinctrl-spmi-mpp.ko",
        "drivers/pinctrl/qcom/pinctrl-volcano.ko",
        "drivers/power/reset/qcom-dload-mode.ko",
        "drivers/power/reset/qcom-pon.ko",
        "drivers/power/reset/qcom-reboot-reason.ko",
        "drivers/power/reset/reboot-mode.ko",
        #"drivers/power/supply/qti_battery_charger.ko",
        "drivers/power/oplus/wireless_pen/oplus_wireless_pen.ko",
        "drivers/power/oplus/v2/oplus_chg_v2.ko",
        "drivers/power/oplus/test-kit/test-kit.ko",
        "drivers/power/oplus/v2/ufcs/ufcs_class.ko",
        "drivers/pwm/pwm-qti-lpg.ko",
        "drivers/regulator/debug-regulator.ko",
        "drivers/regulator/proxy-consumer.ko",
        "drivers/regulator/qcom_pm8008-regulator.ko",
        "drivers/regulator/qpnp-amoled-regulator.ko",
        "drivers/regulator/qpnp-lcdb-regulator.ko",
        "drivers/regulator/qti-fixed-regulator.ko",
        "drivers/regulator/qti-ocp-notifier.ko",
        "drivers/regulator/rpmh-regulator.ko",
        "drivers/regulator/stub-regulator.ko",
        "drivers/regulator/camera_aw37004/oplus_camera_aw37004.ko",
        "drivers/remoteproc/qcom_pil_info.ko",
        "drivers/remoteproc/qcom_q6v5.ko",
        "drivers/remoteproc/qcom_q6v5_pas.ko",
        "drivers/remoteproc/qcom_spss.ko",
        "drivers/remoteproc/qcom_sysmon.ko",
        "drivers/remoteproc/rproc_qcom_common.ko",
        "drivers/rpmsg/glink_pkt.ko",
        "drivers/rpmsg/qcom_glink.ko",
        "drivers/rpmsg/qcom_glink_smem.ko",
        "drivers/rpmsg/qcom_glink_spss.ko",
        "drivers/rpmsg/qcom_smd.ko",
        "drivers/rtc/rtc-pm8xxx.ko",
        "drivers/scsi/sg.ko",
        "drivers/slimbus/slim-qcom-ngd-ctrl.ko",
        "drivers/slimbus/slimbus.ko",
        "drivers/soc/qcom/adsp_sleepmon.ko",
        "drivers/soc/qcom/altmode-glink.ko",
        "drivers/soc/qcom/boot_stats.ko",
        "drivers/soc/qcom/cdsprm.ko",
        "drivers/soc/qcom/charger-ulog-glink.ko",
        "drivers/soc/qcom/cmd-db.ko",
        "drivers/soc/qcom/core_hang_detect.ko",
        "drivers/soc/qcom/cpucp_log.ko",
        "drivers/soc/qcom/crm.ko",
        "drivers/soc/qcom/crypto-qti.ko",
        "drivers/soc/qcom/dcc_v2.ko",
        "drivers/soc/qcom/dcvs/bwmon.ko",
        "drivers/soc/qcom/dcvs/bwprof.ko",
        "drivers/soc/qcom/dcvs/c1dcvs_scmi_v2.ko",
        "drivers/soc/qcom/dcvs/cpufreq_stats_scmi_v2.ko",
        "drivers/soc/qcom/dcvs/dcvs_fp.ko",
        "drivers/soc/qcom/dcvs/dynpf_scmi.ko",
        "drivers/soc/qcom/dcvs/memlat.ko",
        "drivers/soc/qcom/dcvs/mpam.ko",
        "drivers/soc/qcom/dcvs/mpam_game.ko",
        "drivers/soc/qcom/dcvs/qcom-dcvs.ko",
        "drivers/soc/qcom/dcvs/qcom-pmu-lib.ko",
        "drivers/soc/qcom/dcvs/qcom_scmi_client.ko",
        "drivers/soc/qcom/debug_symbol.ko",
        "drivers/soc/qcom/dmesg_dumper.ko",
        "drivers/soc/qcom/eud.ko",
        "drivers/soc/qcom/gh_cpusys_vm_mem_access.ko",
        "drivers/soc/qcom/gh_tlmm_vm_mem_access.ko",
        "drivers/soc/qcom/gic_intr_routing.ko",
        "drivers/soc/qcom/glink_probe.ko",
        "drivers/soc/qcom/health_monitor.ko",
        "drivers/soc/qcom/hung_task_enh.ko",
        "drivers/soc/qcom/hwkm.ko",
        "drivers/soc/qcom/llcc-qcom.ko",
        "drivers/soc/qcom/llcc_perfmon.ko",
        "drivers/soc/qcom/mdt_loader.ko",
        "drivers/soc/qcom/mem-hooks.ko",
        "drivers/soc/qcom/mem-offline.ko",
        "drivers/soc/qcom/mem_buf/mem_buf.ko",
        "drivers/soc/qcom/mem_buf/mem_buf_dev.ko",
        "drivers/soc/qcom/mem_buf/mem_buf_msgq.ko",
        "drivers/soc/qcom/memory_dump_v2.ko",
        "drivers/soc/qcom/memshare/heap_mem_ext_v01.ko",
        "drivers/soc/qcom/memshare/msm_memshare.ko",
        "drivers/soc/qcom/minidump.ko",
        "drivers/soc/qcom/msm_performance.ko",
        "drivers/soc/qcom/msm_show_epoch.ko",
        "drivers/soc/qcom/panel_event_notifier.ko",
        "drivers/soc/qcom/pcie-pdc.ko",
        "drivers/soc/qcom/pdr_interface.ko",
        "drivers/soc/qcom/pmic-glink-debug.ko",
        "drivers/soc/qcom/pmic-pon-log.ko",
        "drivers/soc/qcom/pmic_glink.ko",
        "drivers/soc/qcom/qcom_aoss.ko",
        "drivers/soc/qcom/qcom_cpu_vendor_hooks.ko",
        "drivers/soc/qcom/qcom_cpucp.ko",
        "drivers/soc/qcom/qcom_cpuss_sleep_stats.ko",
        "drivers/soc/qcom/qcom_logbuf_boot_log.ko",
        "drivers/soc/qcom/qcom_logbuf_vendor_hooks.ko",
        "drivers/soc/qcom/qcom_ramdump.ko",
        "drivers/soc/qcom/qcom_rpmh.ko",
        "drivers/soc/qcom/qcom_stats.ko",
        "drivers/soc/qcom/qcom_va_minidump.ko",
        "drivers/soc/qcom/qcom_wdt_core.ko",
        "drivers/soc/qcom/qfprom-sys.ko",
        "drivers/soc/qcom/qmi_helpers.ko",
        "drivers/soc/qcom/qsee_ipc_irq_bridge.ko",
        "drivers/soc/qcom/qti_battery_debug.ko",
        "drivers/soc/qcom/secure_buffer.ko",
        "drivers/soc/qcom/smem.ko",
        "drivers/soc/qcom/oplus_smp2p.ko",
        "drivers/soc/qcom/smp2p_sleepstate.ko",
        "drivers/soc/qcom/socinfo.ko",
        "drivers/soc/qcom/sps/sps_drv.ko",
        "drivers/soc/qcom/sys_pm_vx.ko",
        "drivers/soc/qcom/sysmon_subsystem_stats.ko",
        "drivers/soc/qcom/tmecom/tmecom-intf.ko",
        "drivers/soc/qcom/wcd_usbss_i2c.ko",
        "drivers/soc/qcom/fsa4480-i2c.ko",
        "drivers/spi/spi-msm-geni.ko",
        "drivers/spmi/spmi-pmic-arb.ko",
        "drivers/spmi/spmi-pmic-arb-debug.ko",
        "drivers/thermal/qcom/bcl_pmic5.ko",
        "drivers/thermal/qcom/bcl_soc.ko",
        "drivers/thermal/qcom/cpu_hotplug.ko",
        "drivers/thermal/qcom/cpu_voltage_cooling.ko",
        "drivers/thermal/qcom/ddr_cdev.ko",
        "drivers/thermal/qcom/gpu_dump_skip_cdev.ko",
        "drivers/thermal/qcom/max31760_fan.ko",
        "drivers/thermal/qcom/msm_lmh_dcvs.ko",
        "drivers/thermal/qcom/qcom-spmi-temp-alarm.ko",
        "drivers/thermal/qcom/qcom_tsens.ko",
        "drivers/thermal/qcom/qti_cpufreq_cdev.ko",
        "drivers/thermal/qcom/qti_devfreq_cdev.ko",
        "drivers/thermal/qcom/qti_qmi_cdev.ko",
        "drivers/thermal/qcom/qti_qmi_sensor_v2.ko",
        "drivers/thermal/qcom/qti_userspace_cdev.ko",
        "drivers/thermal/qcom/thermal_config.ko",
        "drivers/thermal/qcom/thermal_minidump.ko",
        "drivers/thermal/qcom/thermal_pause.ko",
        "drivers/tty/hvc/hvc_gunyah.ko",
        "drivers/tty/serial/msm_geni_serial.ko",
        "drivers/ufs/host/ufs_qcom.ko",
        "drivers/ufs/host/ufshcd-crypto-qti.ko",
        "drivers/uio/msm_sharedmem/msm_sharedmem.ko",
        "drivers/usb/dwc3/dwc3-msm.ko",
        "drivers/usb/gadget/function/f_fs_ipc_log.ko",
        "drivers/usb/gadget/function/usb_f_ccid.ko",
        "drivers/usb/gadget/function/usb_f_cdev.ko",
        "drivers/usb/gadget/function/usb_f_gsi.ko",
        "drivers/usb/gadget/function/usb_f_rndis.ko",
        "drivers/usb/gadget/function/usb_f_qdss.ko",
        "drivers/usb/phy/phy-generic.ko",
        "drivers/usb/phy/phy-msm-snps-eusb2.ko",
        "drivers/usb/phy/phy-msm-ssusb-qmp.ko",
        "drivers/usb/phy/phy-qcom-emu.ko",
        "drivers/usb/redriver/nb7vpq904m.ko",
        "drivers/usb/redriver/redriver.ko",
        "drivers/usb/repeater/repeater.ko",
        "drivers/usb/repeater/repeater-qti-pmic-eusb2.ko",
        "drivers/usb/typec/ucsi/ucsi_glink.ko",
        "drivers/video/backlight/qcom-spmi-wled.ko",
        "drivers/virt/gunyah/gh_ctrl.ko",
        "drivers/virt/gunyah/gh_dbl.ko",
        "drivers/virt/gunyah/gh_irq_lend.ko",
        "drivers/virt/gunyah/gh_mem_notifier.ko",
        "drivers/virt/gunyah/gh_msgq.ko",
        "drivers/virt/gunyah/gh_panic_notifier.ko",
        "drivers/virt/gunyah/gh_rm_booster.ko",
        "drivers/virt/gunyah/gh_rm_drv.ko",
        "drivers/virt/gunyah/gh_virt_wdt.ko",
        "drivers/virt/gunyah/gunyah_loader.ko",
        "drivers/virt/gunyah/gunyah_qcom.ko",
        "kernel/msm_sysstats.ko",
        "kernel/sched/walt/sched-penalty.ko",
        "kernel/sched/walt/sched-walt.ko",
        "kernel/trace/qcom_ipc_logging.ko",
        "lib/crc-itu-t.ko",
        "net/mac80211/mac80211.ko",
        "net/qrtr/qrtr.ko",
        "net/qrtr/qrtr-gunyah.ko",
        "net/qrtr/qrtr-mhi.ko",
        "net/qrtr/qrtr-smd.ko",
        "net/wireless/cfg80211.ko",
        "sound/soc/codecs/snd-soc-hdmi-codec.ko",
        "sound/usb/snd-usb-audio-qmi.ko",
        "drivers/soc/oplus/multimedia/oplus_mm_kevent.ko",
        "drivers/soc/oplus/multimedia/oplus_mm_kevent_fb.ko",
        "drivers/soc/oplus/trackpoint/oplus_trackpoint_report.ko",
        "drivers/soc/oplus/boot/cmdline_parser/oplusboot.ko",
        "drivers/soc/oplus/boot/cmdline_parser/oplus_ftm_mode.ko",
        "drivers/soc/oplus/boot/cmdline_parser/buildvariant.ko",
        "drivers/soc/oplus/boot/cmdline_parser/cdt_integrity.ko",
        "drivers/soc/oplus/boot/cmdline_parser/oplus_charger_present.ko",
        "drivers/soc/oplus/boot/oplus_projectinfo/oplus_bsp_boot_projectinfo.ko",
        "drivers/soc/oplus/boot/bootmode/boot_mode.ko",
        "drivers/soc/oplus/boot/bootloader_log/bootloader_log.ko",
        "drivers/soc/oplus/boot/htb/tango32.ko",
        "drivers/soc/oplus/device_info/device_info.ko",
        "drivers/soc/oplus/dft/common/olc/olc.ko",
        "drivers/soc/oplus/dft/common/feedback/kernel_fb.ko",
        "drivers/base/kernelFwUpdate/oplus_bsp_fw_update.ko",
        "drivers/base/touchpanel_notify/oplus_bsp_tp_notify.ko",
        "kernel/oplus_cpu/cpufreq_health/oplus_bsp_cpufreq_health.ko",
        "drivers/soc/oplus/boot/qcom_watchdog/qcom_enhance_watchdog.ko",
        "kernel/oplus_cpu/sched/sched_assist/oplus_bsp_sched_assist.ko",
        "kernel/oplus_cpu/sched/eas_opt/oplus_bsp_eas_opt.ko",
        "kernel/oplus_cpu/sched/frame_boost/oplus_bsp_frame_boost.ko",
        "kernel/oplus_cpu/sched/task_cpustats/oplus_bsp_task_cpustats.ko",
        "kernel/oplus_cpu/sched/task_sched/oplus_bsp_task_sched.ko",
        "kernel/oplus_cpu/sched/sched_info/oplus_bsp_schedinfo.ko",
        "kernel/oplus_cpu/uad/cpufreq_uag.ko",
        "kernel/oplus_cpu/uad/ua_cpu_ioctl.ko",
        "kernel/oplus_cpu/waker_identify/oplus_bsp_waker_identify.ko",
        "kernel/oplus_cpu/oplus_omrg/oplus_bsp_omrg.ko",
        "kernel/oplus_cpu/cpufreq_bouncing/cpufreq_bouncing.ko",
        "kernel/oplus_cpu/oplus_overload/oplus_bsp_task_overload.ko",
        "drivers/soc/oplus/mdmrst/oplus_mdmrst.ko",
        "mm/mm_osvelte/oplus_bsp_mm_osvelte.ko",
        "drivers/soc/oplus/storage/common/storage_log/oplus_storage_log.ko",
        "drivers/soc/oplus/storage/common/oplus_uprobe/oplus_uprobe.ko",
        "drivers/soc/oplus/power/subsys_sleep_monitor/oplus_subsys_sleep_monitor.ko",
        "drivers/misc/oplus_procs_load/oplus_procs_load.ko",
        "drivers/misc/oplus_power_notifier/oplus_power_notifier.ko",
        "drivers/nfc/thn31/tms_device_modules.ko",
        "drivers/nfc/oplus_nfc/oplus_nfc.ko"
    ]

    # Updated for kernel modules that are dynamically loaded based on environment variables
    # 为根据环境变量而动态加载的内核模块而更新
    _bsp_drv_inject_in_tree_modules = [
        # keep sorted
        "drivers/power/oplus/debug-kit/debug-kit.ko",
    ]

    features = _get_oplus_features()
    key = 'OPLUS_FEATURE_BSP_DRV_INJECT_TEST'
    if features.get(key, '0').upper() in ['1', 'TRUE']:
        _pineapple_in_tree_modules += _bsp_drv_inject_in_tree_modules

    _pineapple_consolidate_in_tree_modules = _pineapple_in_tree_modules + [
        # keep sorted
        "drivers/cpuidle/governors/qcom_simple_lpm.ko",
        "drivers/hwtracing/coresight/coresight-etm4x.ko",
        "drivers/misc/lkdtm/lkdtm.ko",
        "drivers/usb/misc/ehset.ko",
        "drivers/usb/misc/lvstest.ko",
        "kernel/locking/locktorture.ko",
        "kernel/rcu/rcutorture.ko",
        "kernel/torture.ko",
        "lib/atomic64_test.ko",
        "lib/test_user_copy.ko",
    ]

    kernel_vendor_cmdline_extras = [
        # do not sort
        "console=ttyMSM0,115200n8",
        "qcom_geni_serial.con_enabled=1",
        "bootconfig",
    ]

    for variant in la_variants:
        board_kernel_cmdline_extras = []
        board_bootconfig_extras = []

        if variant == "consolidate":
            mod_list = _pineapple_consolidate_in_tree_modules
        else:
            mod_list = _pineapple_in_tree_modules
            board_kernel_cmdline_extras += ["nosoftlockup"]
            kernel_vendor_cmdline_extras += ["nosoftlockup"]

        define_msm_la(
            msm_target = target_name,
            variant = variant,
            in_tree_module_list = mod_list,
            boot_image_opts = boot_image_opts(
                kernel_vendor_cmdline_extras = kernel_vendor_cmdline_extras,
                board_kernel_cmdline_extras = board_kernel_cmdline_extras,
                board_bootconfig_extras = board_bootconfig_extras,
            ),
            # dpm_overlay = True,
        )
